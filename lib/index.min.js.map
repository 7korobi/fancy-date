{"version":3,"sources":["webpack://VuePetitStore/webpack/universalModuleDefinition","webpack://VuePetitStore/webpack/bootstrap","webpack://VuePetitStore/./src/struct.coffee","webpack://VuePetitStore/external \"lodash\"","webpack://VuePetitStore/external \"memory-orm\"","webpack://VuePetitStore/./src/index.coffee","webpack://VuePetitStore/./src/browser.coffee","webpack://VuePetitStore/external \"tiny-cookie\"","webpack://VuePetitStore/./src/firebase.coffee","webpack://VuePetitStore/external \"firebase\"","webpack://VuePetitStore/./src/vuex.coffee","webpack://VuePetitStore/./src/poll.coffee","webpack://VuePetitStore/external \"dexie\"","webpack://VuePetitStore/./src/path.coffee"],"names":["root","factory","exports","module","define","amd","global","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_","nine_hour","relative_to","timezone","to_msec","to_sec","to_tempo","to_x","params","query","hash","is_replace","to","val","cloneDeep","type","sp","nil","u","constructor","str","timeout","replace","num","unit","Number","Error","timestr","since","gap","next_at","now_idx","write_at","Date","last_at","parseInt","types","[object Object]","to_str","String","by_str","by_url","Array","JSON","stringify","parse","require","Cookie","test","set","expres","remove","window","localStorage","setItem","removeItem","sessionStorage","history","error","console","warn","replaceState","id","default_id","type_id","created","this","mounted","newVal","$route","beforeRouteUpdate","newRoute","oldRoute","next","watch","href","location","$router","resolve","pushState","getItem","handle_id","addEventListener","beforeDestroy","removeEventListener","cookie","options","expires","Mem","firebase","firestore","firestore_base","joinSnapshot","store","settings","target","shot","eject","gate","log","onSnapshot","path","chk","del","add","snap","add_id","chk_id","comp","del_id","join","join_id","join_target","path_id","query_id","snap_id","snapshot","_firestore","assign","data","step","State","methods","computed","firestore_models","set_key","slice","_id","ref","doc","delete","merge","collection","qs","docChanges","forEach","newIndex","oldIndex","Set","firestore_model","firestore_collection","firestore_doc","exists","vuex_read","keys","dir","split","map","$store","state","vuex","mutation","setter","commit","Dexie","dexie","is_cache","is_online","is_visible","poll","_ref5","default","document","version","stores","meta","opt","timers","_waitwake","destroyed","results","clearTimeout","get_by_network","idx","_ref","_asyncToGenerator","list","_this","navigator","onLine","visibilityState","Promise","all","dispatch","apply","arguments","cache","vuex_id","rootState","roop","url","_ref2","get_by_lf","get_pass","_ref3","_ref4","wait","pack","_api","put","setTimeout","caches","opts","cb","fetch","res","json","transaction","_x","_x2","api","Query","path_by","idx_a","at","length","find"],"mappings":"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","file":"lib/index.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VuePetitStore\"] = factory();\n\telse\n\t\troot[\"VuePetitStore\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","_ = require 'lodash'\n\nrelative_to = ({ name, params, query, hash }, o, is_replace)->\n  unless is_replace\n    params = _.cloneDeep params\n    query  = _.cloneDeep query\n  to = { name, params, query, hash }\n  for key, val of o\n    if params[key]\n      params[key] = val\n    else\n      query[key] = val\n  to\n\nto_x = (type, sp, nil)-> (u)->\n  switch u?.constructor\n    when null, undefined, sp\n      nil\n    when type\n      u\n    else\n      type u\n\nto_msec = (str)->\n  1000 * to_sec str\n\nto_sec = (str)->\n  timeout = 0\n  str.replace /(\\d+)(.)|0/g, (_, num, unit)->\n    return unless num = Number num\n    timeout +=\n      switch unit\n        when \"s\"\n          num\n        when \"m\"\n          60 * num\n        when \"h\"\n          3600 * num\n        when \"d\"\n          3600 * 24 * num\n        when \"w\"\n          3600 * 24 * 7 * num\n        when \"y\"\n          3600 * 24 * 365 * num\n        else\n          throw new Error \"#{timestr} at #{num}#{unit}\"\n  timeout\n\nto_tempo = (since, gap = \"0s\")->\n  since = to_msec since\n  gap   = to_msec gap\n  gap  -= nine_hour\n\n  write_at = new Date - 0\n\n  now_idx = parseInt(( write_at - gap) / since)\n  last_at = (now_idx + 0) * since + gap\n  next_at = (now_idx + 1) * since + gap\n  timeout = next_at - write_at\n\n  { last_at, write_at, next_at, timeout, now_idx, timezone, since, gap }\n\nmodule.exports = {\n  relative_to\n  to_sec\n  to_msec\n  to_tempo\n  types:\n    [Number]:\n      to_str: to_x String, NaN, \"\"\n      by_str: to_x Number, \"\", NaN\n      by_url: to_x Number, \"\", NaN\n    [String]:\n      to_str: to_x String, null, \"\"\n      by_str: to_x String, \"\", null\n      by_url: to_x String, \"\", null\n    [Array]:\n      to_str: JSON.stringify\n      by_str: JSON.parse\n      by_url: to_x Array, null, null\n    [Object]:\n      to_str: JSON.stringify\n      by_str: JSON.parse\n}\n\nnine_hour = to_msec '9hour'\ntimezone = -nine_hour\n","module.exports = require(\"lodash\");","module.exports = require(\"memory-orm\");","module.exports = {\n  ...require \"./struct\"\n  ...require \"./browser\"\n  ...require \"./firebase\"\n  ...require \"./vuex\"\n  ...require \"./poll\"\n  ...require \"./path\"\n}","_ = require 'lodash'\nCookie = require 'tiny-cookie'\n{ types, relative_to } = require \"./struct\"\n\ntry\n  test = '__vue-localstorage-test__'\n\n  Cookie.set test, test, expres: '1M'\n  Cookie.remove test\n\n  window.localStorage.setItem test, test\n  window.localStorage.removeItem test\n\n  window.sessionStorage.setItem test, test\n  window.sessionStorage.removeItem test\n\n  history || throw new Error \"can't use history API.\"\ncatch e\n  console.warn 'Local storage not supported by this browser'\n\n\nmodule.exports = m =\n  replaceState: (id)->\n    default_id = \"#{id}_default\"\n    type_id = \"#{id}_type\"\n\n    created: ->\n      @[default_id] = _.get @, id\n      @[type_id] = types[@[default_id].constructor]\n\n    mounted: ->\n      newVal = @$route.params[id] || @$route.query[id]\n      newVal = @[type_id].by_url newVal\n      newVal ?= @[default_id]\n      @[id] = newVal\n\n    beforeRouteUpdate: (newRoute, oldRoute, next)->\n      next()\n      newVal = newRoute.params[id] || newRoute.query[id]\n      newVal = @[type_id].by_url newVal\n      newVal ?= @[default_id]\n      @[id] = newVal\n\n    watch:\n      [id]: ( newVal )->\n        { location, href } = @$router.resolve relative_to @$route, { [id]: newVal }, true\n        history.replaceState null, null, href\n\n  pushState: (id)->\n    default_id = \"#{id}_default\"\n    type_id = \"#{id}_type\"\n\n    created: ->\n      @[default_id] = _.get @, id\n      @[type_id] = types[@[default_id].constructor]\n\n    mounted: ->\n      newVal = @$route.params[id] || @$route.query[id]\n      newVal = @[type_id].by_url newVal\n      newVal ?= @[default_id]\n      @[id] = newVal\n\n    beforeRouteUpdate: (newRoute, oldRoute, next)->\n      next()\n      newVal = newRoute.params[id] || newRoute.query[id]\n      newVal = @[type_id].by_url newVal\n      newVal ?= @[default_id]\n      @[id] = newVal\n\n    watch:\n      [id]: ( newVal )->\n        { location, href } = @$router.resolve relative_to @$route, { [id]: newVal }, true\n        history.pushState null, null, href\n\n  sessionStorage: (id)->\n    default_id = \"#{id}_default\"\n    type_id = \"#{id}_type\"\n\n    created: ->\n      @[default_id] = _.get @, id\n      @[type_id] = types[@[default_id].constructor]\n\n    mounted: ->\n      newVal = window.sessionStorage.getItem id\n      if newVal?\n        @[id] = @[type_id].by_str newVal\n\n    watch:\n      [id]: ( newVal )->\n        if newVal?\n          s = @[type_id].to_str newVal\n          window.sessionStorage.setItem id, s\n        else\n          window.sessionStorage.removeItem id\n\n  localStorage: (id)->\n    default_id = \"#{id}_default\"\n    handle_id = \"#{id}_handle\"\n    type_id = \"#{id}_type\"\n\n    created: ->\n      @[default_id] = _.get @, id\n      @[type_id] = types[@[default_id].constructor]\n\n    mounted: ->\n      newVal = window.localStorage.getItem id\n      if newVal?\n        @[id] = @[type_id].by_str newVal\n\n      @[handle_id] = ({ key, newVal })=>\n        if key == id\n          @[id] = @[type_id].by_str newVal\n      window.addEventListener \"storage\", @[handle_id]\n    \n    beforeDestroy: ->\n      window.removeEventListener \"storage\", @[handle_id]\n\n    watch:\n      [id]: ( newVal )->\n        if newVal?\n          s = @[type_id].to_str newVal\n          window.localStorage.setItem id, s\n        else\n          window.localStorage.removeItem id\n\n  cookie: (id, options = { expires: '1M' })->\n    default_id = \"#{id}_default\"\n    type_id = \"#{id}_type\"\n\n    created: ->\n      @[default_id] = _.get @, id\n      @[type_id] = types[@[default_id].constructor]\n\n    mounted: ->\n      newVal = Cookie.get id\n      if newVal?\n        @[id] = @[type_id].by_str newVal\n\n    watch:\n      [id]: ( newVal )->\n        if newVal?\n          s = @[type_id].to_str newVal\n          Cookie.set id, s, options\n        else\n          Cookie.remove id\n\n","module.exports = require(\"tiny-cookie\");","Mem = require \"memory-orm\"\n\nif window?\n  firebase = require \"firebase\"\n\nfirestore = ->\n  store = firebase.firestore()\n  store.settings {}\n  store\n\njoinSnapshot = (target, shot)->\n  eject = ->\n  (gate)->\n    eject()\n    eject =\n      if gate && @[target]\n        console.log \"join\", gate\n        @[target].onSnapshot shot.bind @\n      else\n        ->\n\nfirestore_base = (id, path, chk, query, { del, add, snap, shot })->\n  default_id = \"#{id}_default\"\n\n  query_id = \"#{id}_query\"\n  snap_id  = \"#{id}_snap\"\n\n  chk_id  = \"#{id}_chk\"\n  path_id = \"#{id}_path\"\n\n  join_id = \"#{id}_join\"\n  add_id  = \"#{id}_add\"\n  del_id  = \"#{id}_del\"\n\n  [ snapshot, join_target ] =\n    if chk && query\n      [ chk_id, query_id ]\n    else\n      [ path_id, snap_id ]\n  join = joinSnapshot join_target, shot\n\n  comp =\n    _firestore: firestore\n    [path_id]: path\n    [snap_id]: ->\n      if @[path_id]\n        snap.call @, @[path_id]\n\n  if chk && query\n    Object.assign comp,\n      [chk_id]: chk\n      [query_id]: ->\n        if @[chk_id] && @[snap_id]\n          query.call @, @[snap_id]\n\n  data: ->\n    step: Mem.State.step\n\n  mounted: ->\n    @[default_id] = @[id]\n    @[join_id] @[snapshot]\n\n  beforeDestroy: ->\n    @[join_id] undefined\n\n  methods:\n    [join_id]: join\n    [add_id]: add\n    [del_id]: del\n\n  computed: comp\n\n  watch:\n    [snapshot]: join\n\n\nmodule.exports = m =\n  firestore_models: (id, path, chk, query)->\n    snap_id = \"#{id}_snap\"\n    set_key = id[..-2]\n    firestore_base id, path, chk, query,\n      del: (_id)->\n        return unless _id\n        @[snap_id]?.doc(_id).delete()\n      add: (doc)->\n        { _id } = doc\n        return unless _id\n        @[snap_id]?.doc(_id).set doc,\n          merge: true\n      snap: (path)->\n        @_firestore.collection path\n      shot: (qs)->\n        qs.docChanges().forEach ({ newIndex, oldIndex, type, doc })=>\n          switch type\n            when 'added', 'modified'\n              Mem.Set[set_key].add doc.data()\n            when 'removed'\n              Mem.Set[set_key].remove doc.id\n\n  firestore_model: (id, path)->\n    snap_id = \"#{id}_snap\"\n    set_key = id\n    firestore_base id, path, null, null,\n      del: ->\n        @[snap_id]?.delete()\n      add: (doc)->\n        @[snap_id]?.set doc,\n          merge: true\n      snap: (path)->\n        @_firestore.doc path\n      shot: (doc)->\n        if o = doc.data()\n          Mem.Set[set_key].add o\n        else\n          Mem.Set[set_key].remove doc.id\n\n  firestore_collection: (id, path, chk, query)->\n    snap_id = \"#{id}_snap\"\n    firestore_base id, path, chk, query,\n      del: (_id)->\n        return unless _id\n        @[snap_id]?.doc(_id).delete()\n      add: (doc)->\n        { _id } = doc\n        return unless _id\n        @[snap_id]?.doc(_id).set doc,\n          merge: true\n      snap: (path)->\n        @_firestore.collection path\n      shot: (qs)->\n        qs.docChanges().forEach ({ newIndex, oldIndex, type, doc })=>\n          switch type\n            when 'added', 'modified'\n              @[id][doc.id] = doc.data()\n            when 'removed'\n              delete @[id][doc.id]\n\n  firestore_doc: (id, path)->\n    snap_id = \"#{id}_snap\"\n    default_id = \"#{id}_default\"\n    firestore_base id, path, null, null,\n      del: ->\n        @[snap_id]?.delete()\n      add: (doc)->\n        @[snap_id]?.set doc,\n          merge: true\n      snap: (path)->\n        @_firestore.doc path\n      shot: (doc)->\n        @[id] =\n          if doc.exists\n            doc.data()\n          else\n            @[default_id]\n","module.exports = require(\"firebase\");","_ = require 'lodash'\n\nmodule.exports = m =\n  vuex_read: (path, keys)->\n    dir = path.split('.')\n    computed = {}\n    keys.map (key)->\n      getter = [...dir[0..-1], key].join('.')\n      computed[key] =\n        get: ->\n          _.get @$store.state, getter\n    { computed }\n\n  vuex: (path, keys)->\n    dir = path.split('.')\n    computed = {}\n    keys.forEach (key)->\n      mutation = \"#{dir[0]}/update\"\n      getter = [...dir[0..-1], key].join('.')\n      setter = [...dir[1..-1], key].join('.')\n      computed[key] =\n        get: ->\n          _.get @$store.state, getter\n        set: (val)->\n          o = _.set {}, setter, val\n          @$store.commit mutation, o\n    { computed }\n\n","Mem = require 'memory-orm'\nDexie = require(\"dexie\").default\n\n{ to_tempo } = require \"./struct\"\n\nis_cache = {}\nis_online = is_visible = false\n\nif document?\n  dexie = new Dexie 'giji'\n  dexie\n  .version(1).stores\n    meta: '&idx'\n    data: '&idx'\n\n\npoll = (opt)->\n  data: ->\n    step: Mem.State.step\n\n  mounted: ->\n    @timers = {}\n    window.addEventListener 'offline', @_waitwake\n    window.addEventListener 'online', @_waitwake\n    document.addEventListener 'visibilitychange', @_waitwake\n    @_waitwake()\n      \n  destroyed: ->\n    window.removeEventListener 'offline', @_waitwake\n    window.removeEventListener 'online', @_waitwake\n    document.removeEventListener 'visibilitychange', @_waitwake\n    for key, val of @timers\n      clearTimeout val\n\n  methods:\n    get_by_network: ->\n      for key, val of @timers\n        clearTimeout val\n\n      list = opt.call @\n      list.map ([name, id])=>\n        idx = [name, id].join(\"&\")\n        dexie.meta.delete idx\n        dexie.data.delete idx\n        is_cache[idx] = 0\n      @_waitwake()\n\n    _waitwake: ->\n      is_online  = window.navigator.onLine\n      is_visible = 'hidden' != document.visibilityState\n      is_ok = is_online && is_visible\n      if is_ok\n        list = opt.call @\n        await Promise.all list.map ([name, id])=>\n          @$store.dispatch name, { id, name, @timers }\n      else\n        for key, val of @timers\n          clearTimeout val\n\npoll.cache = (timestr, vuex_id, opt)->\n  # console.log { timestr, timeout, url: opt('*') }\n  ({ dispatch, state, commit, rootState }, { id, name, timers })->\n    url = opt id\n    idx = [name, id].join(\"&\")\n\n    roop = ->\n      { last_at, write_at, next_at, timeout } = to_tempo timestr\n\n\n      get_pass = ->\n        wait = new Date - write_at\n        console.log { timestr, idx, wait, url: null }\n\n      get_by_lf = ->\n        { pack } = await dexie.data.get idx\n        Mem.State.store pack\n        wait = new Date - write_at \n        console.log { timestr, idx, wait, url: '(LF)' }\n\n      get_by_network = ->\n        pack = await poll._api[name] url, id\n        await dexie.data.put { idx, pack }\n        wait = new Date - write_at\n        console.log { timestr, idx, wait, url }\n\n\n      if write_at < is_cache[idx]\n        get_pass()\n      else\n        # IndexedDB metadata not use if memory has past data, \n        unless 0 < is_cache[idx]\n          meta = await dexie.meta.get idx\n\n        switch\n          when write_at < meta?.next_at\n            await get_by_lf()\n\n          when 0 < meta?.next_at\n            await get_by_lf()\n            await get_by_network()\n\n          else\n            await get_by_network()\n            dexie.meta.put { idx, next_at }\n\n      is_cache[idx] = next_at\n      if timeout < 0x7fffffff  #  ほぼ25日\n        timers[url] = setTimeout roop, timeout\n    roop()\n\npoll.caches = (timestr, opts)->\n  for key, cb of opts\n    opts[key] = poll.cache timestr, key, cb\n  opts\n\npoll._api =\n  fetch: (url, cb)->\n    res = await fetch url\n    data = await res.json()\n    Mem.State.transaction ->\n      cb data\n\npoll.api = (o)->\n  Object.assign poll._api, o\n\nmodule.exports = { poll }\n","module.exports = require(\"dexie\");","{ Query } = require 'memory-orm'\n\nmodule.exports = m =\n  path_by: (idx = 'idx', keys)->\n    idx_a = \"#{idx}_a\"\n    computed = {}\n    computed[idx_a] =\n      get: ->\n        @[idx].split(\"-\")\n\n    keys.forEach (name, at)->\n      return unless name\n      key  = \"#{name}_id\"\n      list = \"#{name}s\"\n      computed[key] =\n        get: ->\n          if at < @[idx_a].length\n            @[idx_a][0..at].join(\"-\")\n      computed[name] =\n        get: ->\n          Query[list].find @[key]\n    { computed }\n"],"sourceRoot":""}